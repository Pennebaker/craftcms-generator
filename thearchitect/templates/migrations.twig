{% extends "_layouts/cp" %}
{% set title = "The Architect"|t %}

{% macro migrationsToggleForm(value, buttonText) %}
<form action="" method="post" accept-charset="UTF-8" class="quick-action">
    <input type="hidden" name="action" value="plugins/savePluginSettings">
    <input type="hidden" name="pluginClass" value="TheArchitect">
    <input type="hidden" name="redirect" value="thearchitect/migrations">
    {{ getCsrfInput() }}
    <input type="hidden" name="settings[enableMigrations]" value="{{ value }}">
    <input type="submit" class="updatestatus btn small" value="{{ buttonText }}">
</form>
{% endmacro %}

{% macro quickActionForm(action, buttonText) %}
<form action="" method="post" accept-charset="UTF-8" class="quick-action">
    <input type="hidden" name="action" value="theArchitect/{{ action }}">
    <input type="hidden" name="redirect" value="thearchitect/migrations">
    {{ getCsrfInput() }}
    <input type="submit" class="updatestatus btn small" value="{{ buttonText }}">
</form>
{% endmacro %}

{% import "_includes/forms" as forms %}
{% from _self import quickActionForm, migrationsToggleForm %}

{% set tabs = {
    tab1: { label: "Raw Input"|t, url: url('thearchitect') },
    tab2: { label: "Available Files"|t, url: url('thearchitect/files') },
    tab3: { label: "Export"|t, url: url('thearchitect/blueprint') },
    tab4: { label: "Migrations"|t, url: url('thearchitect/migrations') },
    tab5: { label: "Matrix to Neo Export"|t, url: url('thearchitect/convert') },
} %}

{% set selectedTab = 'tab4' %}

{% set docsUrl = 'https://github.com/Pennebaker/craftcms-thearchitect/wiki' %}

{% set content %}
<div class="the-architect">

    <h2>Status</h2>
    {% if migrationsEnabled %}<span class="status green"></span>Enabled{{ migrationsToggleForm(0, 'Disable') }}{% else %}<span class="status red"></span>Disabled{{ migrationsToggleForm(1, 'Enable') }}{% endif %}
    <div>
        Last Export on {{ exportTime|date("F d Y @ g:i a") }}{{ quickActionForm('migrationExport', 'Run Export') }}
    </div>
    <div>
        Last Import on {{ importTime|date("F d Y @ g:i a") }}
    </div>

    <h2>API</h2>
    {% if apiKey %}
        <code class="token">{{ apiKey }}</code>{{ quickActionForm('generateKey', 'Generate New Key') }}
        <p>
            <code id="apiKey">{{ siteUrl(craft.config.get('actionTrigger') ~ '/theArchitect/apiExport', { key: apiKey }) }}</code>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 64 64" class="copyKey" data-clipboard-text="{{ siteUrl(craft.config.get('actionTrigger') ~ '/theArchitect/apiExport', { key: apiKey }) }}"><path fill="#231F20" d="M48 14H16c-2.2 0-4 1.8-4 4v32c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V18c0-2.2-1.8-4-4-4z" opacity=".2"/><path fill="#E0995E" d="M48 12H16c-2.2 0-4 1.8-4 4v32c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V16c0-2.2-1.8-4-4-4z"/><path fill="#231F20" d="M16 18h32v32H16z" opacity=".2"/><path fill="#FFF" d="M16 16h32v32H16z"/><path fill="#E0E0D1" d="M22 24h20v2H22zm0 4h20v2H22zm0 4h20v2H22zm0 4h20v2H22zm0 4h20v2H22z"/><path fill="#231F20" d="M37 12H24v5c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-5h-3z" opacity=".2"/><path fill="#4F5D73" d="M37 10H24v5c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-5h-3z"/></svg>
        </p>
        <p>
            <code id="apiKey">{{ siteUrl(craft.config.get('actionTrigger') ~ '/theArchitect/apiImport', { key: apiKey, force: false }) }}</code>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 64 64" class="copyKey" data-clipboard-text="{{ siteUrl(craft.config.get('actionTrigger') ~ '/theArchitect/apiImport', { key: apiKey, force: false }) }}"><path fill="#231F20" d="M48 14H16c-2.2 0-4 1.8-4 4v32c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V18c0-2.2-1.8-4-4-4z" opacity=".2"/><path fill="#E0995E" d="M48 12H16c-2.2 0-4 1.8-4 4v32c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V16c0-2.2-1.8-4-4-4z"/><path fill="#231F20" d="M16 18h32v32H16z" opacity=".2"/><path fill="#FFF" d="M16 16h32v32H16z"/><path fill="#E0E0D1" d="M22 24h20v2H22zm0 4h20v2H22zm0 4h20v2H22zm0 4h20v2H22zm0 4h20v2H22z"/><path fill="#231F20" d="M37 12H24v5c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-5h-3z" opacity=".2"/><path fill="#4F5D73" d="M37 10H24v5c0 1.7 1.3 3 3 3h10c1.7 0 3-1.3 3-3v-5h-3z"/></svg>
        </p>
    {% else %}
        {{ quickActionForm('generateKey', 'Generate Key') }}
    {% endif %}

</div>
{% endset %}
